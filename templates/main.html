<!DOCTYPE html>
<html lang="en">
  <head>
    <meta
      name="viewport"
      content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no"
    />
    <title>Locatable</title>
    <link
      rel="stylesheet"
      href="{{ url_for('static', filename='css/main_style.css')}}"
    />
    <link rel="shortcut icon" href="#" />
    <link
      rel="stylesheet"
      href="//use.fontawesome.com/releases/v5.15.4/css/all.css"
    />
  </head>
  <body>
    <div class="home-main-container">
      <div class="navbar-container">
        <p class="navbar-title" onclick="location.assign('/')">Locatable</p>
        <div class="navbar-list">
          <p onclick="location.assign('/explore')">EXPLORE</p>
          {% if session["email"] and session["user_mode"] == "OWNER" %}
          <p onclick="location.assign('/listVenue')">LIST MY VENUE</p>
          {% else %}
          <p>LIST MY VENUE</p>
          {% endif %}

          <div class="account-div">
            <div class="account-button" id="account-button">
              <p id="account-button-content"></p>
            </div>
            <div class="account-menu-content" id="account-menu-loggedOut">
              <p onclick="logOut()">LOG OUT</p>
            </div>
            <div class="account-menu-content" id="account-menu-loggedIn">
              <h1>SIGN IN</h1>
              <form
                action=""
                method="post"
                class="signIn-form"
                id="signIn-form"
              >
                <div class="input-section">
                  <label for="email">Email:</label>
                  <input type="email" id="email" name="email" />
                </div>

                <div class="input-section">
                  <label for="password">Password:</label>
                  <input type="password" id="password" name="password" />
                </div>
                <div class="input-section">
                  <label class="switch user-selector-switch">
                    <input
                      type="checkbox"
                      name="user_mode"
                      id="user_mode"
                      value="1"
                    />
                    <label
                      id="user_mode_label"
                      for="user_mode"
                      data-on="OWNER"
                      data-off="CUSTOMER"
                      class="user-selector-switch-inner"
                    ></label>
                  </label>
                </div>
                <button type="submit">Sign In</button>
              </form>
            </div>
          </div>
        </div>
      </div>
      <div class="welcome-container">
        <h1>WELCOME SECTION</h1>
        <div class="search-bar-container">
          <div class="search-bar-section search-bar-location">
            <div class="search-bar-subsection">
              <p>Choose Location</p>
              <img
                id="dropdown-arrow-location"
                src="../static/images/arrow-down.svg"
                alt="dropdown-arrow-icon"
                onclick="updateArrowIcon('location')"
              />
            </div>
            <div class="dropdown-menu" id="location-dropdown"></div>
          </div>
          <div class="search-bar-section search-bar-category">
            <div class="search-bar-subsection">
              <p>Choose Category</p>
              <img
                id="dropdown-arrow-category"
                src="../static/images/arrow-down.svg"
                alt="dropdown-arrow-icon"
                onclick="updateArrowIcon('category')"
              />
            </div>
            <div class="dropdown-menu" id="category-dropdown"></div>
          </div>
          <div class="search-bar-section search-bar-capacity">
            <div class="search-bar-subsection">
              <p>Choose Capacity</p>
              <img
                id="dropdown-arrow-capacity"
                src="../static/images/arrow-down.svg"
                alt="dropdown-arrow-icon"
                onclick="updateArrowIcon('capacity')"
              />
            </div>
          </div>
          <div class="search-bar-btn">
            <img src="../static/images/search.svg" alt="search-icon" />
          </div>
        </div>
      </div>
      <div class="home-cards-container">
        <div class="home-cards-item">
          <img
            class="card-item-image"
            src="../static/images/birthday-cake.svg"
          />
          <div class="opacity-seperator"></div>
          <h1 class="card-item-text">Birthday</h1>
        </div>
        <div class="home-cards-item">
          <img
            class="card-item-image"
            src="../static/images/party-popper.svg"
          />
          <div class="opacity-seperator"></div>
          <h1 class="card-item-text">Party</h1>
        </div>
        <div class="home-cards-item">
          <img
            class="card-item-image"
            src="../static/images/wedding-rings.svg"
          />
          <div class="opacity-seperator"></div>
          <h1 class="card-item-text">Weddings</h1>
        </div>
      </div>
      <div class="footer-container">
        <p>The place to find the venue you need!</p>
        <p>Locatable Â© 2023</p>
      </div>
    </div>

    <script>
      let locationArrow = document.getElementById("dropdown-arrow-location");
      let categoryArrow = document.getElementById("dropdown-arrow-category");
      let capacityArrow = document.getElementById("dropdown-arrow-capacity");

      function updateArrowIcon(element) {
        switch (element) {
          case "location":
            let locationSrc = locationArrow.src.substr(
              locationArrow.src.indexOf("-") + 1
            );

            if (locationSrc === "down.svg") {
              locationArrow.src = "../static/images/arrow-up.svg";
              document.getElementById("location-dropdown").style.visibility =
                "visible";
            } else {
              locationArrow.src = "../static/images/arrow-down.svg";
              document.getElementById("location-dropdown").style.visibility =
                "hidden";
            }
            break;

          case "category":
            let categorySrc = categoryArrow.src.substr(
              categoryArrow.src.indexOf("-") + 1
            );

            if (categorySrc === "down.svg") {
              categoryArrow.src = "../static/images/arrow-up.svg";
              document.getElementById("category-dropdown").style.visibility =
                "visible";
            } else {
              categoryArrow.src = "../static/images/arrow-down.svg";
              document.getElementById("category-dropdown").style.visibility =
                "hidden";
            }
            break;

          case "capacity":
            let capacitySrc = capacityArrow.src.substr(
              capacityArrow.src.indexOf("-") + 1
            );
            if (capacitySrc === "down.svg") {
              capacityArrow.src = "../static/images/arrow-up.svg";
            } else {
              capacityArrow.src = "../static/images/arrow-down.svg";
            }
            break;
        }
      }

      let accountButton = document.getElementById("account-button");
      let loggedInMenu = document.getElementById("account-menu-loggedIn");
      let loggedOutMenu = document.getElementById("account-menu-loggedOut");
      let loginForm = document.getElementById("signIn-form");

      accountButton.onclick = () => {
        loggedInMenu.classList.toggle("active");
        loggedOutMenu.classList.toggle("active");
      };

      window.onload = () => {
        let xhr = new XMLHttpRequest();
        xhr.onreadystatechange = function () {
          if (xhr.readyState === XMLHttpRequest.DONE) {
            let response = JSON.parse(xhr.response);
            if (response) {
              if (response.loggedIn) {
                // User is signed In --> show log out menu
                loggedOutMenu.style.display = "flex";
                loggedInMenu.style.display = "none";
              } else {
                // User is not signed In --> show log in menu
                loggedOutMenu.style.display = "none";
                loggedInMenu.style.display = "flex";
              }
            }
          }
        };
        xhr.open("GET", "/loggedIn");
        xhr.send();
      };

      loginForm.addEventListener("submit", (e) => {
        e.preventDefault();
        console.log("line 239");
        let email = document.getElementById("email");
        let password = document.getElementById("password");
        let userMode = document.getElementById("user_mode");

        if (email.value == "" || password.value == "") {
          alert("Ensure you input a value in both fields!");
        } else {
          let xhr = new XMLHttpRequest();
          xhr.onreadystatechange = function () {
            if (xhr.response == "signedIn") {
              window.location.assign("/");
            }
          };
          xhr.open("POST", "/signIn");
          xhr.setRequestHeader("Content-type", "application/json");
          let data = JSON.stringify({
            email: email.value,
            password: password.value,
            userMode: userMode.checked,
          });
          xhr.send(data);
        }
      });

      function logOut() {
        let xhr = new XMLHttpRequest();
        xhr.onreadystatechange = () => {
          if (xhr.response == "signedOut") {
            window.location.assign("/");
          }
        };
        xhr.open("POST", "/signOut");
        xhr.send();
      }
    </script>
  </body>
</html>
